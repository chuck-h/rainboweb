<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- lib name is: eosjsName -->
<!-- script src="https://cdn.jsdelivr.net/npm/eosjs-account-name@2.3.0/lib/index.js"></script -->
<script type="text/javascript">
var networklist = [{name: "Telos mainnet", contract: "oswapper1111",
                    endpoints: ["https://telos.caleos.io/", "https://mainnet.telos.net/"] },
                   {name: "Local testnet", contract: "oswapper",
                    endpoints: ["http://127.0.0.1:8888/"] }
                  ];
var chain_endpoint;
var active_auth;
var configured;

function setup_networks() {
  $('#networks').empty();
  for(n in networklist) {
    $("<option/>").html(networklist[n].name).appendTo("#networks");
  }
}
function update_network() {
  const selected_net = networklist.find((n) => n.name === document.getElementById("networks").value);
  document.getElementById("contract_account").value = selected_net.contract;
  chain_endpoint = selected_net.endpoints[0]; // todo: failover on dead endpoint
}


function offsetDateHTML(isoDate) {
  let htmlDate = new Date(isoDate);
  htmlDate.setMinutes(htmlDate.getMinutes() - htmlDate.getTimezoneOffset());
  return htmlDate.toLocaleString("sv-SE", {
    year: "numeric", month: "2-digit", day: "2-digit", hour: "2-digit", minute: "2-digit",
    second: "2-digit"}).replace(" ", "T");
}

const asset_selector_ids = [
  "withdraw_asset",
  "input_asset",
  "output_asset",
  "add_asset",
  "forget_asset",
  "send_asset"
]

function getAssets() {
  asset_selector_ids.forEach( (id) => 
    document.getElementById(id).options.length = 0
  )
  // TODO handle paging ('more' field = true)
  getRows("assetsa", document.getElementById("contract_account").value, // will need lower_limit for pagination
    function(data, status, jqXHR){
      setAssetDatalist(data, status, jqXHR)
      // maybe test for "more" and dispatch an HTML event here
    },
    function(x,s,e) { } );
}
function setAssetDatalist(data, status, jqXHR) {
  data["rows"].sort((a,b) => (a.symbol_code > b.symbol_code) ? 1 : 
                             ((b.symbol_code > a.symbol_code) ? -1 : 
                              ((a.contract_name > b.contract_name) ? 1 :
                               ((b.contract_name > a.contract_name) ? -1 : 0))))
    .forEach(function(row) {
       //console.log(row)
       const option_string = `${row.symbol.padEnd(7,' ')} ${
                                row.contract_name.padEnd(13,' ')} id:${row.token_id}`
      asset_selector_ids.forEach( (id) => {
        sel = document.getElementById(id)
        sel.options[sel.options.length] = new Option(option_string, option_string)
      })
  });
}

function getLiqQueue() {
  document.getElementById("liqqueue").options.length=0
  getRows("adpreps", document.getElementById("contract_account").value,
    function(data, status, jqXHR){
      setLiqQueueList(data, status, jqXHR)
    },
    function(x,s,e) { } );
}
function setLiqQueueList(data, status, jqXHR) {
  data["rows"].sort((a,b) => (a.nonce - b.nonce))
    .forEach(function(row) {
       //console.log(row)
       minutes_remaining = (Date.parse(row.expires+"Z") - Date.now())/60000
       const option_string = row.nonce.toString() + " " + row.amount.toString() +
            " from " + row.account.toString() + ((minutes_remaining < 0) ? " EXPIRED" : "")
       sel = document.getElementById("liqqueue")
       sel.options[sel.options.length] = new Option(option_string, option_string)

  });
}

function getExchgQueue() {
  document.getElementById("exchgqueue").options.length=0
  getRows("expreps", document.getElementById("contract_account").value,
    function(data, status, jqXHR){
      setExchgQueueList(data, status, jqXHR)
    },
    function(x,s,e) { } );
}
function setExchgQueueList(data, status, jqXHR) {
  data["rows"].sort((a,b) => (a.nonce - b.nonce))
    .forEach(function(row) {
       console.log(row)
       minutes_remaining = (Date.parse(row.expires+"Z") - Date.now())/60000
       const option_string = row.nonce.toString() + " " +
                                row.in_amount.toString() + " from " + row.sender.toString() +
                                " to " +row.recipient.toString() + ((minutes_remaining < 0) ? " EXPIRED" : "")
       sel = document.getElementById("exchgqueue")
       sel.options[sel.options.length] = new Option(option_string, option_string)

  });
}


function openTab(evt, tabName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  if( evt != null) {
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
  }
  clearQR();
  if( tabName=="Configure" ) {
    setupConfigureTab();
  }
  if( tabName=="AddLiqPrep" ) {
    setupAddLiquidityTab();
  }
  if( tabName=="WithdrawLiquidity" ) {
    setupWithdrawLiquidityTab();
  }
  if( tabName=="PrepExchange" ) {
    setupPrepExchangeTab();
  }
  if( tabName=="TopUpRam" ) {
    setupRamTab();
  }
  if( tabName=="Send" ) {
    setupSendTab();
  }
}
function setupConfigureTab() {
  getRows("configs", document.getElementById("contract_account").value, 
    function(data, status, jqXHR){
      configured = data.rows.length != 0;
      if( configured ) {
        document.getElementById("contract_mgr").value = data.rows[0].manager;
        document.getElementById("life_msec").value = data.rows[0].nonce_life_msec;
      }
    },
    function(x,s,e) { } );
}
function config_trx() {
  let actions=[];
  let authorization = configured ? 
       [ {actor: document.getElementById("contract_mgr").value, permission: "active"} ] :
       [ {actor: document.getElementById("contract_account").value, permission: "owner"} ]
  actions.push({
    account: document.getElementById("contract_account").value, name: "init",
    data: {
      manager: document.getElementById("contract_mgr").value,
      nonce_life_msec: document.getElementById("life_msec").value,
      chain: "Telos",
    },
    authorization: authorization
  })

  transaction =  {
    actions: actions
  }
  return transaction;
}  

function register_trx() {
  const actor = document.getElementById("registrant").value;
  let actions=[];
  actions.push({
    account: document.getElementById("contract_account").value,
    name: "createasseta",
    data: {
      actor: actor,
      chain: "Telos",
      contract: document.getElementById("token_contract").value,
      symbol: document.getElementById("token_symbol").value,
      meta: document.getElementById("asset_meta").value,
    },
    authorization: [{actor: actor, permission: "active"}]
  })

  transaction =  {
    actions: actions
  }
  return transaction;
}

function addliq_trx() {
    let actions=[];
    actions.push({
      account: document.getElementById("contract_account").value, name: "addliqprep",
      data: {
        account: document.getElementById("liq_source").value,
        token_id: document.getElementById("add_asset").value.slice(-1), // TODO handle n>9
        amount: document.getElementById("add_amount").value,
        weight: (document.getElementById("add_weight").value.toString()),
      },
      authorization: [{actor: "............1", permission: "............2"}]
    })

    transaction =  {
      actions: actions
    }
    return transaction;
}

function setupAddLiquidityTab() {  
  getAssets()
}

function setupWithdrawLiquidityTab() {  
  getAssets()
}

function setupPrepExchangeTab() {  
  getAssets()
}

function prepExchange_trx() {
    const mods = document.getElementById("in_exact_checked").value ? '{"exact": "in"}' : '{"exact": "out"}';
    let actions=[];
    actions.push({
      account: document.getElementById("contract_account").value, name: "exchangeprep",
      data: {
        sender: document.getElementById("exch_sender").value,
        in_token_id: document.getElementById("input_asset").value.slice(-1), // TODO handle n>9
        in_amount: document.getElementById("input_amt").value,
        recipient: document.getElementById("exch_recip").value,
        out_token_id: document.getElementById("output_asset").value.slice(-1),
        out_amount: document.getElementById("output_amt").value,
        mods: mods,
        memo: ""
      },
      authorization: [{actor: "............1", permission: "active"}]
    })
    transaction =  {
      actions: actions
    }
    return transaction;
}

var pendingExch;
var pendingAdd;
function updatePending() {
  getRows("expreps", document.getElementById("contract_account").value, 
    function(data, status, jqXHR){
      if( data.rows.length != 0 ) {
        pendingExch = data["rows"].sorted((a,b) => (a.expires > b.expires) ? 1 : 
                         ((b.expires > a.expires) ? -1 : 0))
      }
    },
    function(x,s,e) { } );
  getRows("addprep", document.getElementById("contract_account").value, 
    function(data, status, jqXHR){
      if( data.rows.length != 0 ) {
        pendingAdd = data["rows"].sorted((a,b) => (a.expires > b.expires) ? 1 : 
                         ((b.expires > a.expires) ? -1 : 0))
      }
    },
    function(x,s,e) { } );
}

function setupRamTab() {
  document.getElementById("seeds2telos_qty").value = "5.0000";
  document.getElementById("seeds2telos").checked = true;
  document.getElementById("buyram").checked = true;
  document.getElementById("ram_recipient").value = document.getElementById("contract_account").value;
}

var withdraw;
function send_trx(actor) {
    let actions=[];
    const toke = document.getElementById("send_asset").value.split(/\s+/)
    console.log(toke);
    actions.push({
      account: toke[1], name: "transfer",
      data: {
        quantity: (document.getElementById("send_qty").value + " " + toke[0]),
        from: document.getElementById("send_from").value,
        to: document.getElementById("send_to").value,
        memo: document.getElementById("send_memo").value
      },
      authorization: [{actor: actor, permission: "active"}]
    })

    transaction =  {
      actions: actions
    }
    return transaction;
}

function updateSendTab() {
  const toke = document.getElementById("send_asset").value.split(/\s+/)
  getRows("stat", toke[0], 
    function(data, status, jqXHR){
      if( data.rows.length != 0 ) {
        const max_supply = data.rows[0].max_supply ?? data.rows[0].initial_supply; // token.seeds quirk
        let qtysplit = max_supply.split(" ")[0].split(".");
        if( qtysplit.length == 1 ) {
          document.getElementById("send_qty").value = "1";
        } else {
          document.getElementById("send_qty").value = `1.${qtysplit[1]}`; 
        }
      }
    },
    function(x,s,e) { },
    toke[1] );
}

function setupSendTab() {
  getAssets();
  getLiqQueue();
  getExchgQueue();
  updateSendTab(); // TODO make update execute after asset list has been loaded.
  document.getElementById("send_from").value = "";
  document.getElementById("send_to").value = document.getElementById("contract_account").value;
  document.getElementById("send_memo").value = "";
}


const esr_gen_base = "https://cc42.xyz";

function esrGenUrl() {
  const selected_net = networklist.find((n) => n.name === document.getElementById("networks").value);
  return esr_gen_base + '/qr';
}
function makeQR(transaction) {
    transaction.endpoint = chain_endpoint.slice(0, -1); // trim terminal '/'
    $.ajax({
      type: "POST",
      url: esrGenUrl(),
      data: JSON.stringify(transaction),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: function(data, status, jqXHR) {
        qrcode.innerHTML = `<img src=${data.qr}>`;
        esr.innerHTML = data.esr;
      },
      error: function(xhr, status, error) {
        esr.innerHTML = xhr.responseText;
      }
    });
}
function clearQR() {
    note.innerHTML = '';
    qrcode.innerHTML = ``;
    esr.innerHTML = ``;
}

function genProposalName() {
    var name = document.getElementById("contract_account").value.slice(0,6);
    for (let i=6; i<10; i++) {
      digit =  Math.floor(Math.random()*4.99 + 1).toString();
      name += digit;
    }
    return name;
}
function makeMsigProposeQR_step1(transaction) {
    // get account/permission signatories from chain
    const account = transaction.actions[0].authorization[0].actor;
    const permission = transaction.actions[0].authorization[0].permission;
    const url = chain_endpoint + "v1/chain/get_account";
    const data ={ account_name: account};
    $.ajax({
      type: "POST",
      url: url,
      data: JSON.stringify(data),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: function(data, status, jqXHR) {
        let signers = data.permissions.filter( x => x.perm_name==permission )[0].
          required_auth.accounts?.map( a => a.permission ).
          filter( p => p.permission !== "eosio.code");
        if( !Array.isArray(signers) || signers.length == 0) {
          note.innerHTML = `${account} has no delegated msig signer(s)`;
        } else {
          makeMsigProposeQR_step2(transaction, account, permission, signers);
        }
      },
      error: function(xhr, status, error) {
        if(erroraction==null) {
          alert(xhr.responseText);
        } else {
          erroraction(xhr, status, error);
        }
      }
    });
}
    
function makeMsigProposeQR_step2(transaction, account, permission, signers) {
    // serialize inner transaction
    $.ajax({
      type: "POST",
      url: esr_gen_base + '/tx',
      data: JSON.stringify(transaction),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: function(data, status, jqXHR) {
        makeMsigProposeQR_step3(data, account, signers);
      },
      error: function(xhr, status, error) {
        esr.innerHTML = xhr.responseText;
      }
    });
}
function makeMsigProposeQR_step3(serialized_transaction, account, signers) {
    // build msig propose with all signatories
    const duration_days = 3;
    var expiration = new Date();
    expiration.setDate(expiration.getDate() + duration_days);
    const trx_hdr = {
      expiration: expiration.toISOString().split('.')[0],
      ref_block_num: 0,
      ref_block_prefix: 0,
      max_net_usage_words: 0,
      max_cpu_usage_ms: 0,
      delay_sec: 0,
      context_free_actions: [],
      transaction_extensions: []
    }

    const propose_action = {
      account: "eosio.msig", name: "propose",
      data: {
        proposer: "............1",
        proposal_name: genProposalName(),
        requested: signers,
        trx: {...trx_hdr, actions: serialized_transaction}
      },
      authorization: [{actor: "............1", permission: "active"}]
    }

    const proposal =  {
      actions: [ propose_action ]
    }
    proposal.endpoint = chain_endpoint.slice(0, -1); // trim terminal '/'
    $.ajax({
      type: "POST",
      url: esrGenUrl(),
      data: JSON.stringify(proposal),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: function(data, status, jqXHR) {
        const prop = proposal.actions[0].data.proposal_name;
        note.innerHTML = 
          `msig proposal <a href=https://explorer.telos.net/proposal/${prop}> ${prop} </a>`;
        qrcode.innerHTML = `<img src=${data.qr}>`;
        esr.innerHTML = data.esr;
      },
      error: function(xhr, status, error) {
        esr.innerHTML = xhr.responseText;
      }
    });
}

function getRows(table, scope, action, erroraction=null, code=null) {
  const url = chain_endpoint + "v1/chain/get_table_rows";
  const code_was_null = (code==null);
  if (code_was_null) {
    code = document.getElementById("contract_account").value;
  }
  const data ={ code: code,
                table: table,
                scope: scope,
                limit: 40,
                json: "true" };
  if (!code_was_null) {
    console.log("getRows "+JSON.stringify(data));
  }           
    $.ajax({
      type: "POST",
      url: url,
      data: JSON.stringify(data),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: action,
      error: function(xhr, status, error) {
        if(erroraction==null) {
          alert(xhr.responseText);
        } else {
          erroraction(xhr, status, error);
        }
      }
    });
// TBD
}

$(document).ready(function () {
  setup_networks();
  update_network();
  $('#networks').click(function(){
    update_network();
  });
  $('#contract_account').change(function(){
    const selected_net = networklist.find((n) => n.name === document.getElementById("networks").value);
    selected_net.contract = document.getElementById("contract_account").value;
    console.log(networklist);
    openTab(null, null);
  });
  $('#configure_QR').click(function(){
    const transaction = config_trx();
    console.log(transaction);
    makeQR(transaction);
  });
  $('#configure_msig_propose_QR').click(function(){
    const transaction = config_trx(); // call common code for 'init' transaction
    makeMsigProposeQR_step1(transaction);
  });

  $('#register_QR').click(function(){
    const transaction = register_trx();
    makeQR(transaction);
  });

  $('#register_msig_propose_QR').click(function(){
    const transaction = register_trx(); // call common code for 'createasseta' transaction
    makeMsigProposeQR_step1(transaction);  });
    
  $('#add_liq_QR').click(function(){
    const transaction = addliq_trx();
    console.log(transaction);
    makeQR(transaction);
    // TBD: check blockchain for transaction posted, or timeout?
  });
  
  $('#add_liq_msig_propose_QR').click(function(){
    const transaction = addliq_trx();
    makeMsigProposeQR_step1(transaction);
  });

  $('#prep_exch_QR').click(function(){
    const transaction = prepExchange_trx();
    console.log(transaction);
    makeQR(transaction);
    // TBD: check blockchain for transaction posted, or timeout?
  });

  $('#ram_QR').click(function(){
    let actions=[];
    if( document.getElementById("seeds2telos").checked ) {
      actions.push({
        account: "token.seeds", name: "transfer",
        data: {
          quantity: "5.0000 SEEDS",
          from: "............1",
          to: "amm.swaps",
          memo: "swap,0,11"
        },
        authorization: [{actor: "............1", permission: "active"}]
      })
    }
    if( document.getElementById("buyram").checked ) {
      actions.push({
        account: "eosio", name: "buyrambytes",
        data: {
          bytes: 1000,
          payer: "............1",
          receiver: document.getElementById("ram_recipient").value,
        },
        authorization: [{actor: "............1", permission: "active"}]
      })
    }
    transaction =  {
      actions: actions
    }
    console.log(transaction);
    makeQR(transaction);
    // TBD: check blockchain for transaction posted, or timeout?
  });
  $('#send_asset').change(function(){
    updateSendTab()
  });

  $('#send_QR').click(function(){
    const transaction = send_trx("............1");
    console.log(transaction);
    makeQR(transaction);
  });
  $('#send_msig_propose_QR').click(function(){
    var actor; 
    if ( document.getElementById("send_to").value == withdraw ) {
      actor = withdraw;
    } else {
      actor = document.getElementById("send_from").value;
    }
    const transaction = send_trx(actor);
    makeMsigProposeQR_step1(transaction);
  });
  
  $('input').change(function(){
    clearQR();
  });
  $('textarea').change(function(){
    clearQR();
  });
 
});
</script>

<style>
body {
  font-size: 100%;
}
@media only screen and (max-width: 740px) {
  body {
    font-size: 150%;
  }
  .button {
    text-align: center;
    font-size: 100%;
  }
}
/* Style the tab */
.tab {
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

/* Style the buttons inside the tab */
.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
  font-size: 17px;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
  background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
  display: none;
  padding: 6px 12px;
  border: 1px solid #ccc;
  border-top: none;
}

label {
  display: inline-block;
  width: 12em;
  text-align: right;
}
.radiolabelhoriz {
  display: inline-block;
  width: 6em;
  text-align: right;
}


</style>
</head>
<body>

<h1 style="display:inline; margin:0; float:right; color: red;">BETA</h1>
<h2>oSwap token exchange</h2>
 Reference document <a href="https://docs.google.com/document/d/1ZglSqrfUC93UO6DqDn_0n4P2lc8a54-O8oEJgPq5lgc/edit"> here</a>
. oSwaps contract repository <a href="https://github.com/chuck-h/oswaps-smart-contracts"> here</a>
. This website repository <a href="https://github.com/chuck-h/rainboweb"> here</a>.
<div style="background-color:Aquamarine;">
  <p>
  <label for="networks">Network:</label>
  <select name="networks" id="networks"> </select>
  <datalist id="networks"></datalist>
  </p>
  <p>
  <label for="contract_account" >Master Contract:</label>
  <input id="contract_account"></input> <br>
  </p>
</div>

<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'Configure')">Configure</button>
  <button class="tablinks" onclick="openTab(event, 'RegisterAsset')">Register Asset</button>
  <button class="tablinks" onclick="openTab(event, 'AddLiqPrep')">Prep Add Liquidity</button>
  <button class="tablinks" onclick="openTab(event, 'PrepExchange')">Prep Exchange</button>
  <button class="tablinks" onclick="openTab(event, 'WithdrawLiquidity')">Withdraw Liquidity</button>
  <button class="tablinks" onclick="openTab(event, 'UnregisterAsset')">Unregister Asset</button>
  <button class="tablinks" onclick="openTab(event, 'TopUpRam')">Top Up RAM</button>
  <button class="tablinks" onclick="openTab(event, 'Send')">Send Tokens</button>
</div>


<div id="Configure" class="tabcontent" style="background-color:Beige;" >
  <h3>Configure oSwap contract</h3>
  <p>
  <label for="contract_mgr">Manager:</label>
  <input type="text" id="contract_mgr" name="contract_mgr" value=""> <br>
  <label for="life_msec">Pending lifetime (msec):</label>
  <input type="text" id="life_msec" name="life_msec" value=""> <br>
  </p>
  <div id="button-wrapper">
    <input type="button" id="configure_QR" value="Create QR" class="button">
    <input type="button" value="Clear QR" onclick="clearQR()" class="button">
    <input type="button" id="configure_msig_propose_QR" value="Propose Msig QR" class="button">
  </div>

</div>

<div id="RegisterAsset" class="tabcontent" style="background-color:Beige;">
  <h3>Register an Asset</h3>
  <p>
    <label for="registrant">Registrant:</label>
    <input type="text" id="registrant" name="registrant" value=""> <br>
    <label for="token_contract">Token contract:</label>
    <input type="text" id="token_contract" name="token_contract" value=""> <br>
    <label for="token_symbol">Token symbol:</label>
    <input type="text" id="token_symbol" name="token_symbol" value=""> <br>
    <label for="asset_meta">Asset metadata:</label>
    <input type="text" id="asset_meta" name="asset_meta" value=""> <br>

  </p>
   <br>
  <div id="button-wrapper">
    <input type="button" id="register_QR" value="Create QR" class="button">
    <input type="button" value="Clear QR" onclick="clearQR()" class="button">
    <input type="button" id="register_msig_propose_QR" value="Propose Msig QR" class="button">
  </div>

</div>

<div id="AddLiqPrep" class="tabcontent" style="background-color:Beige;">
  <h3>Add Liquidity - setup</h3>
  <label for="liq_source">Source account:</label>
  <input type="text" id="liq_source" name="liq_source" value=""> <br>
  <label for="add_asset">Token:</label>
  <select name="add_asset" id="add_asset"></select><br>
  <label for="add_amount">Quantity:</label>
  <input type="text" id="add_amount" name="add_amount" value=""> <br>
  <label for="add_weight">Weighting:</label>
  <input type="text" id="add_weight" name="add_weight" value=""> <br>
  <br>
  <div id="button-wrapper">
    <input type="button" id="add_liq_QR" value="Create QR" class="button">
    <input type="button" value="Clear QR" onclick="clearQR()" class="button">
    <input type="button" id="add_liq_msig_propose_QR" value="Propose Msig QR" class="button">
  </div>

</div>

<div id="WithdrawLiquidity" class="tabcontent" style="background-color:Beige;">
  <h3>Withdraw Liquidity</h3>
  <label for="liq_recip">Recipient account:</label>
  <input type="text" id="liq_recip" name="liq_recip" value=""> <br>
  <label for="withdraw_asset">Token:</label>
  <select name="withdraw_asset" id="withdraw_asset"></select><br>
  <label for="withdraw_amount">Quantity:</label>
  <input type="text" id="withdraw_amount" name="withdraw_amount" value=""> <br>
  <label for="withdraw_weight">Weighting:</label>
  <input type="text" id="withdraw_weight" name="withdraw_weight" value=""> <br>
  <br>
  <div id="button-wrapper">
    <input type="button" id="add_liq_QR" value="Create QR" class="button">
    <input type="button" value="Clear QR" onclick="clearQR()" class="button">
    <input type="button" id="add_liq_msig_propose_QR" value="Propose Msig QR" class="button">
  </div>

</div>

<div id="PrepExchange" class="tabcontent" style="background-color:Beige;">
  <h3>Exchange Transaction - setup</h3>
  <div id="stakeselector">
    <p>
    <label for="exch_sender">Sender:</label>
    <input type="text" id="exch_sender" name="exch_sender" value=""> <br>
    <label for="input_asset">Input token:</label>
    <select name="input_asset" id="input_asset"></select><br>
    <label for="input_amt">Token quantity:</label>
    <input type="text" id="input_amt" name="input_amt" value=""> <br>
    </p>
    <p>
    <label for="exch_recip">Recipient:</label>
    <input type="text" id="exch_recip" name="exch_recip" value=""> <br>
    <label for="output_asset">Output token:</label>
    <select name="output_asset" id="output_asset"></select><br>
    <label for="output_amt">Token quantity:</label>
    <input type="text" id="output_amt" name="output_amt" value=""> <br>
    </p>
    <p>
    <label for="in_exact">Input is exact:</label>
    <input type="radio" id="in_exact_checked" name="approval" value="in_exact" checked>
    <label for="out_exact" class="radiolabelhoriz">Output is exact:</label>
    <input type="radio" id="out_exact_checked" name="approval" value="out_exact"> <br>
    </p>
    <br>
    <div id="button-wrapper">
      <input type="button" id="prep_exch_QR" value="Create QR" class="button">
      <input type="button" value="Clear QR" onclick="clearQR()" class="button">
    </div>
  </div>
</div>

<div id="UnregisterAsset" class="tabcontent" style="background-color:Beige;">
  <h3>Unregister an Asset</h3>
  <div>
    <label for="forget_asset">Token:</label>
    <select name="forget_asset" id="forget_asset"> </select> <br>
    <br>
    
    <div id="button-wrapper">
      <input type="button" id="permission_QR" value="Create QR" class="button">
      <input type="button" value="Clear QR" onclick="clearQR()" class="button">
      <input type="button" id="permission_msig_propose_QR" value="Propose Msig QR" class="button">
          </div>
  </div>
</div>


<div id="TopUpRam" class="tabcontent" style="background-color:Beige;">
  <h3>Add RAM to contract account</h3>
(Use this if you get an "insufficient RAM" error)<br><br>
  <p>
  This 2-step transaction uses Tswaps to convert SEEDS to TLOS, then uses the TLOS to buy RAM for the Issuer account
  </p>
  <label for="seeds2telos">Convert SEEDS to TLOS</label>
  <input type="checkbox" id="seeds2telos" 
         onclick="document.getElementById('seeds2telos_qty').disabled =
                  !document.getElementById('seeds2telos').checked"> <br>
  <label for="seeds2telos_qty">SEEDS:</label>
  <input type="text" id="seeds2telos_qty" name="seeds2telos_qty"> <br>
  <label for="buyram">Buy 1K of RAM</label>
  <input type="checkbox" id="buyram" > <br>
  <label for="ram_recipient">For:</label>
  <input type="text" id="ram_recipient" name="ram_recipient" value=""> <br>
  <br><br>
  <div id="button-wrapper">
    <input type="button" id="ram_QR" value="Create QR" class="button">
    <input type="button" value="Clear QR" onclick="clearQR()" class="button">
  </div>
</div>

<div id="Send" class="tabcontent" style="background-color:Beige;">
  <h3>Send tokens</h3>
  <label for="liqqueue">Pending liq adds:</label>
  <select name="liqqueue" id="liqqueue"></select><br><br>
  <label for="exchgqueue">Pending swaps:</label>
  <select name="exchgqueue" id="exchgqueue"></select><br><br>
(An ordinary wallet transaction)<br><br>
  <label for="send_asset">Token:</label>
  <select name="send_asset" id="send_asset"></select><br>
  <label for="send_qty">Quantity:</label>
  <input type="text" id="send_qty" name="send_qty" value="1.0000"> <br>
  <label for="send_from">From:</label>
  <input type="text" id="send_from" name="send_from" value=""> <br>
  <label for="send_to">To:</label>
  <input type="text" id="send_to" name="send_to" value=""> <br>
  <label for="send_memo">Memo:</label>
  <textarea rows="2" id="send_memo" name="send_memo" value="" style="vertical-align:middle;"> </textarea> <br><br>
  <div id="button-wrapper">
    <input type="button" id="send_QR" value="Create QR" class="button">
    <input type="button" value="Clear QR" onclick="clearQR()" class="button">
    <input type="button" id="send_msig_propose_QR" value="Propose Msig QR" class="button">
  </div>
</div>

<div id=note> </div>
<div id=qrcode> </div>
<div id=esr> </div>

</body>
</html>

