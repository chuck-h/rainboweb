<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script type="text/javascript">
var testnet_checked;
var test_contract = "histrdotsuds";
var mainnet_contract = "rainbowproto";
const allowall = "allowallacct";    

function testnet_status () {
  testnet_checked = document.getElementById("testmode").checked;
  document.getElementById("contract_account").value = testnet_checked ? test_contract : mainnet_contract;
}
function offsetDateHTML(isoDate) {
  let htmlDate = new Date(isoDate);
  htmlDate.setMinutes(htmlDate.getMinutes() - htmlDate.getTimezoneOffset());
  return htmlDate.toLocaleString("sv-SE", {
    year: "numeric", month: "2-digit", day: "2-digit", hour: "2-digit", minute: "2-digit",
    second: "2-digit"}).replace(" ", "T");
}
function openTab(evt, tabName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
  clearQR();
  if( tabName=="ReviewStakes" ) {
    setupReviewStakesTab();
  }
  if( tabName=="Open" ) {
    setupOpenTab();
  }
  if( tabName=="Create" ) {
    setupCreateTab();
  }
}
function setupCreateTab() {
  getRows("configs", document.getElementById("token_symbol").value, 
    function(data, status, jqXHR){
      if( data.rows.length != 0 ) {
        document.getElementById("closed").checked = data.rows[0].membership_mgr != allowall;
        document.getElementById("member_mgr").value = 
          document.getElementById("closed").checked ? data.rows[0].membership_mgr : "";
        document.getElementById("withdraw_enabled").checked = data.rows[0].withdrawal_mgr != 'eosio.null';
        document.getElementById("withdraw_mgr").value = 
          document.getElementById("withdraw_enabled").checked ? data.rows[0].withdrawal_mgr : "";
        document.getElementById("withdraw_to").value = 
          document.getElementById("withdraw_enabled").checked ? data.rows[0].withdraw_to : "";
        document.getElementById("freeze_enabled").checked = data.rows[0].freeze_mgr != 'eosio.null';
        document.getElementById("freeze_mgr").value = 
          document.getElementById("freeze_enabled").checked ? data.rows[0].freeze_mgr : "";
        document.getElementById("redeem_lock_until").value =
           offsetDateHTML(data.rows[0].redeem_locked_until);
        document.getElementById("config_lock_until").value =
           offsetDateHTML(data.rows[0].config_locked_until);
        document.getElementById("MC_enabled").checked =
           data.rows[0].cred_limit != "" || data.rows[0].positive_limit != "";
        document.getElementById("cred_lim").value = data.rows[0].cred_limit;
        document.getElementById("max_lim").value = data.rows[0].positive_limit;
      }
    },
    function(x,s,e) { } );
  getRows("stat", document.getElementById("token_symbol").value, 
    function(data, status, jqXHR){
      if( data.rows.length != 0 ) {
        document.getElementById("max_supply").value = data.rows[0].max_supply.split(" ")[0];
      }
    },
    function(x,s,e) { } );
}

function setupOpenTab() {
  getRows("configs", document.getElementById("token_symbol").value, 
    function(data, status, jqXHR){
      if( data.rows.length != 0 ) {
        document.getElementById("membership_mgr_acct").value = data.rows[0].membership_mgr;
      }
    },
    function(x,s,e) { } );
}

function setupReviewStakesTab() {
    getRows("stakes", document.getElementById("token_symbol").value,
            function(data, status, jqXHR) {
              if( data.rows.length == 0 ) {
                document.getElementById("stakeselector").style.display = "none";
                document.getElementById("nostakes").style.display = "block";
              } else {
                $("#stakes").empty();
                data["rows"].forEach(function(row) {
                  $("<option/>").html(`${row.index} ${row.stake_per_bucket}`).appendTo("#stakes");
                });
                reviewOneStake(data);
              }        
            },
            function(x,s,e) { 
              document.getElementById("stakeselector").style.display = "none";
              document.getElementById("nostakes").style.display = "block";
            } );
}

function updateReviewStake() {
  getRows("stakes", document.getElementById("token_symbol").value,
          function(data, status, jqXHR) {
            reviewOneStake(data);
          },
          function(x,s,e) { 
            document.getElementById("stakeselector").style.display = "none";
            document.getElementById("nostakes").style.display = "block";
          });
}

function reviewOneStake(data) {
  if( data.rows.length == 0 ) {
    document.getElementById("stakeselector").style.display = "none";
    document.getElementById("nostakes").style.display = "block";
    return;
  }
  document.getElementById("stakeselector").style.display = "block";
  document.getElementById("nostakes").style.display = "none";
  const selectedStake = document.getElementById("stakes").value;
  const selectedIndex = selectedStake.split(" ")[0];
  const selectedRow = data.rows.find(function(row){return row.index==selectedIndex;});
  document.getElementById("r_bucket").value = selectedRow.token_bucket.split(" ")[0];
  document.getElementById("r_staked").value = selectedRow.stake_per_bucket.split(" ")[0];
  document.getElementById("r_stake_symbol").value = selectedRow.stake_per_bucket.split(" ")[1];
  document.getElementById("r_stake_contract").value = selectedRow.stake_token_contract;
  document.getElementById("r_stake_to").value = selectedRow.stake_to;
  document.getElementById("r_proportional").checked = selectedRow.proportional;
}

function updateIssuer() {
  getRows("stat", document.getElementById("token_symbol").value,

          function(data, status, jqXHR) {
            if( data.rows.length != 0 ) {
              document.getElementById("issuer_account").value = data.rows[0].issuer;
            }
          },
          function(x,s,e) { 
          });
  
}
function esrGenUrl() {
  const esr_gen_base = "https://cc42.xyz";
  return esr_gen_base + (testnet_checked ? '/qrt' : '/qr');
}
function makeQR(transaction) {
    $.ajax({
      type: "POST",
      url: esrGenUrl(),
      data: JSON.stringify(transaction),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: function(data, status, jqXHR) {
        qrcode.innerHTML = `<img src=${data.qr}>`;
        esr.innerHTML = data.esr;
      },
      error: function(xhr, status, error) {
        esr.innerHTML = xhr.responseText;
      }
    });
}
function clearQR() {
    qrcode.innerHTML = ``;
    esr.innerHTML = ``;
}
function setTokenDatalist(data, status, jqXHR) {
  $("#tokens").empty();
  data["rows"].forEach(function(row) {
    $("<option/>").html(row.symbolcode).appendTo("#tokens");
  });
}
function emptyTokenDatalist(x,s,e) {
  $("#tokens").empty();
}
function getRows(table, scope, action, erroraction=null) {
  const chain_endpoint = testnet_checked ? "https://testnet.telos.caleos.io/"
                                         : "https://telos.caleos.io/";
  const url = chain_endpoint + "v1/chain/get_table_rows";
  const data ={ code: document.getElementById("contract_account").value,
                table: table,
                scope: scope,
                json: "true" };
    $.ajax({
      type: "POST",
      url: url,
      data: JSON.stringify(data),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: action,
      error: function(xhr, status, error) {
        if(erroraction==null) {
          alert(xhr.responseText);
        } else {
          erroraction(xhr, status, error);
        }
      }
    });
// TBD
}

$(document).ready(function () {
  testnet_status();
  getRows("symbols", document.getElementById("contract_account").value,
          setTokenDatalist, emptyTokenDatalist);
  $('#testmode').click(function(){
    testnet_status();
    getRows("symbols", document.getElementById("contract_account").value,
            setTokenDatalist, emptyTokenDatalist);
  });
  $('#contract_account').change(function(){
    if( testnet_checked ) {
      test_contract = document.getElementById("contract_account").value;
    } else {
      mainnet_contract = document.getElementById("contract_account").value;
    }
    getRows("symbols", document.getElementById("contract_account").value,
            setTokenDatalist, emptyTokenDatalist);
  });
  $('#create').click(function(){
    let membership_mgr = !document.getElementById("closed").checked ? allowall :
                         document.getElementById("member_mgr").value;
    let withdrawal_mgr = !document.getElementById("withdraw_enabled").checked ? "eosio.null" :
                         document.getElementById("withdraw_mgr").value;
    let withdraw_to = !document.getElementById("withdraw_enabled").checked ? "eosio.null" :
                      document.getElementById("withdraw_to").value;
    let freeze_mgr = !document.getElementById("freeze_enabled").checked ? "eosio.null" :
                     document.getElementById("freeze_mgr").value;
    const redeem_date_input = document.getElementById("redeem_lock_until").value;
    const redeem_date = new Date(redeem_date_input=="" ? Date.now() : redeem_date_input);
    const config_date_input = document.getElementById("config_lock_until").value;
    const config_date = new Date(config_date_input=="" ? Date.now() : config_date_input);
    let cred_limit_symbol = !document.getElementById("MC_enabled").checked ? "" :
                            document.getElementById("cred_lim").value;
    let pos_limit_symbol = !document.getElementById("MC_enabled").checked ? "" :
                           document.getElementById("max_lim").value;
    let actions=[];
    actions.push({
      account: document.getElementById("contract_account").value, name: "create",
      data: {
        issuer: document.getElementById("issuer_account").value,
        maximum_supply: (document.getElementById("max_supply").value + " " +
                         document.getElementById("token_symbol").value),
        membership_mgr: membership_mgr,
        withdrawal_mgr: withdrawal_mgr,
        withdraw_to: withdraw_to,
        freeze_mgr: freeze_mgr,
        redeem_locked_until: redeem_date.toISOString(),
        config_locked_until: config_date.toISOString(),
        cred_limit_symbol: document.getElementById("cred_lim").value,
        pos_limit_symbol: document.getElementById("max_lim").value,

      },
      authorization: [{actor: "............1", permission: "active"}]
    })

    transaction =  {
      actions: actions
    }
    console.log(transaction);
    makeQR(transaction);
    // TBD: check blockchain for transaction posted, or timeout?
  });
  $('#approve').click(function(){
    let actions=[];
    actions.push({
      account: document.getElementById("contract_account").value, name: "approve",
      data: {
        symbolcode: document.getElementById("token_symbol").value,
        reject_and_clear: document.getElementById("reject_checked").checked,
      },
      authorization: [{actor: "............1", permission: "active"}]
    })

    transaction =  {
      actions: actions
    }
    console.log(transaction);
    makeQR(transaction);
    // TBD: check blockchain for transaction posted, or timeout?
  });
  $('#setstake').click(function(){
    let actions=[];
    actions.push({
      account: document.getElementById("contract_account").value, name: "setstake",
      data: {
        token_bucket: (document.getElementById("bucket").value + " " +
                         document.getElementById("token_symbol").value),
        stake_per_bucket: (document.getElementById("staked").value + " " +
                         document.getElementById("stake_symbol").value),
        stake_token_contract: document.getElementById("stake_contract").value,
        stake_to: document.getElementById("stake_to").value,
        proportional: document.getElementById("proportional").checked,
        memo: document.getElementById("stake_memo").value,
      },
      authorization: [{actor: "............1", permission: "active"}]
    })

    transaction =  {
      actions: actions
    }
    console.log(transaction);
    makeQR(transaction);
    // TBD: check blockchain for transaction posted, or timeout?
  });
  $('#delete_stake').click(function(){
    let actions=[];
    actions.push({
      account: document.getElementById("contract_account").value, name: "deletestake",
      data: {
        stake_index: document.getElementById("stakes").value.split(" ")[0],
        symbolcode: document.getElementById("r_stake_symbol").value,
        memo: "",
      },
      authorization: [{actor: "............1", permission: "active"}]
    })

    transaction =  {
      actions: actions
    }
    console.log(transaction);
    makeQR(transaction);
    // TBD: check blockchain for transaction posted, or timeout?
  });
  $('#issue_tokens').click(function(){
    let actions=[];
    actions.push({
      account: document.getElementById("contract_account").value, name: "issue",
      data: {
        quantity: (document.getElementById("issue_qty").value + " " +
                   document.getElementById("token_symbol").value),
        memo: document.getElementById("issue_memo").value
      },
      authorization: [{actor: "............1", permission: "active"}]
    })

    transaction =  {
      actions: actions
    }
    console.log(transaction);
    makeQR(transaction);
    // TBD: check blockchain for transaction posted, or timeout?
  });
  $('#enroll_QR').click(function(){
    let opening = document.getElementById("enroll_checked").checked;
    let actions=[];
    let actiondata = {
        owner: document.getElementById("member_acct").value,
        symbolcode: document.getElementById("token_symbol").value,
    };
    if( opening ) {
      if( document.getElementById("membership_mgr_acct").value == allowall) {
        actiondata.ram_payer = document.getElementById("issuer_account").value;
      } else {
        actiondata.ram_payer = document.getElementById("membership_mgr_acct").value;
      }
    }
    actions.push({
      account: document.getElementById("contract_account").value,
      name: opening ? "open" : "close",
      data: actiondata,
      authorization: [{actor: "............1", permission: "active"}]
    })

    transaction =  {
      actions: actions
    }
    console.log(transaction);
    makeQR(transaction);
    // TBD: check blockchain for transaction posted, or timeout?
  });
  $('#stakes').change(function(){
    updateReviewStake();
    clearQR();
  });
  $('#token_symbol').change(function(){
    setupReviewStakesTab();
    setupOpenTab();
    updateIssuer();
  });   
  $('input').change(function(){
    clearQR();
  });
  $('textarea').change(function(){
    clearQR();
  });
 
});
</script>

<style>
body {
  font-size: 100%;
}
@media only screen and (max-width: 740px) {
  body {
    font-size: 150%;
  }
  .button {
    text-align: center;
    font-size: 100%;
  }
}
/* Style the tab */
.tab {
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

/* Style the buttons inside the tab */
.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
  font-size: 17px;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
  background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
  display: none;
  padding: 6px 12px;
  border: 1px solid #ccc;
  border-top: none;
}

label {
  display: inline-block;
  width: 12em;
  text-align: right;
}
.radiolabelhoriz {
  display: inline-block;
  width: 6em;
  text-align: right;
}


</style>
</head>
<body>

<h1 style="display:inline; margin:0; float:right; color: red;">BETA</h1>
<h2>Rainbow token management</h2>

<div style="background-color:Aquamarine;">
  <p>
  <label for="testmode">Use Testnet:</label> <input type="checkbox" id="testmode" >
  </p>
  <datalist id="tokens"></datalist>
  <p>
  <label for="contract_account" >Master Contract:</label>
  <input id="contract_account"></input> <br>
  <label for="token_symbol">Token symbol:</label>
  <input type="text" list="tokens" id="token_symbol" name="token_symbol" value=""> <br>
  <label for="issuer_account">Issuer Account:</label>
  <input type="text" maxlength="12" id="issuer_account" name="issuer_account" value=""> <br>
  </p>
</div>

<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'Create')">Create</button>
  <button class="tablinks" onclick="openTab(event, 'Approve')">Approve</button>
  <button class="tablinks" onclick="openTab(event, 'AddStake')">Add Stake</button>
  <button class="tablinks" onclick="openTab(event, 'ReviewStakes')">Review Stakes</button>
  <button class="tablinks" onclick="openTab(event, 'Display')">Token Info</button>
  <button class="tablinks" onclick="openTab(event, 'Issue')">Issue</button>
  <button class="tablinks" onclick="openTab(event, 'Open')">Enroll</button>
  <button class="tablinks" onclick="openTab(event, 'Redeem')">Redeem</button>
  <button class="tablinks" onclick="openTab(event, 'Freeze')">Freeze</button>
</div>


<div id="Create" class="tabcontent" style="background-color:Beige;" >
  <h3>Token Creation</h3>
  <label for="max_supply">Maximum supply:</label>
  <input type="text" id="max_supply" name="max_supply" value="1000.0000"> <br>
  <p>
  <label for="closed">Closed membership:</label>
  <input type="checkbox" id="closed" checked
         onclick="document.getElementById('member_mgr').disabled = !document.getElementById('closed').checked"> <br>
  <label for="member_mgr">Membership manager:</label>
  <input type="text" id="member_mgr" name="member_mgr" value=""> <br>
  </p>
  <p>
  <label for="withdraw_enabled">Withdrawal enabled:</label>
  <input type="checkbox" id="withdraw_enabled" 
         onclick="document.getElementById('withdraw_mgr').disabled =
                  document.getElementById('withdraw_to').disabled =
                  !document.getElementById('withdraw_enabled').checked"> <br>
  <label for="withdraw_mgr">Withdrawal manager:</label>
  <input type="text" id="withdraw_mgr" name="withdraw_mgr" value="" disabled> <br>
  <label for="withdraw_to">Withdraw-to account:</label>
  <input type="text" id="withdraw_to" name="withdraw_to" value="" disabled> <br>
  </p>
  <p>
  <label for="withdraw_enabled">Freeze enabled:</label>
  <input type="checkbox" id="freeze_enabled" checked
         onclick="document.getElementById('freeze_mgr').disabled =
                  !document.getElementById('freeze_enabled').checked"> <br>
  <label for="freeze_mgr">Freeze manager:</label>
  <input type="text" id="freeze_mgr" name="freeze_mgr" value=""> <br>
  </p>
  <label for="redeem_lock_until">Redeem locked until:</label>
  <input type="datetime-local" id="redeem_lock_until" name="redeem_lock_until" value=""> <br>
  <label for="config_lock_until">Configuration locked until:</label>
  <input type="datetime-local" id="config_lock_until" name="config_lock_until" value=""> <br>
  <p>
  <label for="MC_enabled">Mutual Credit features:</label>
  <input type="checkbox" id="MC_enabled" 
         onclick="document.getElementById('cred_lim').disabled =
                  document.getElementById('max_lim').disabled =
                  !document.getElementById('MC_enabled').checked"> <br>
  <label for="cred_lim">Credit limit symbol:</label>
  <input type="text" id="cred_lim" name="cred_lim" value="" disabled> <br>
  <label for="max_lim">Maximum limit symbol:</label>
  <input type="text" id="max_lim" name="max_lim" value="" disabled> 
  </p>
  <div id="button-wrapper">
    <input type="button" id="create" value="Create QR" class="button">
    <input type="button" value="Clear QR" onclick="clearQR()" class="button">
  </div>

</div>

<div id="Approve" class="tabcontent" style="background-color:Beige;">
  <h3>Approve or reject token</h3>
  <p>
  <label for="approve">Approve:</label>
  <input type="radio" id="approve_checked" name="approval" value="approved" checked>
  <label for="reject_checked" class="radiolabelhoriz">Reject:</label>
  <input type="radio" id="reject_checked" name="approval" value="rejected"> <br>
  </p>
   <br>
  <div id="button-wrapper">
    <input type="button" id="approve" value="Create QR" class="button">
    <input type="button" value="Clear QR" onclick="clearQR()" class="button">
  </div>

</div>

<div id="AddStake" class="tabcontent" style="background-color:Beige;">
  <h3>Add Stake</h3>
  <label for="bucket">Token quantity:</label>
  <input type="text" id="bucket" name="bucket" value="1.0000"> <br>
  <label for="staked">Staked quantity:</label>
  <input type="text" id="staked" name="staked" value="1.0000"> <br>
  <label for="stake_symbol">Staked symbol:</label>
  <input type="text" id="stake_symbol" name="stake_symbol" value=""> <br>
  <label for="stake_contract">Staked contract:</label>
  <input type="text" id="stake_contract" name="stake_contract" value=""> <br>
  <label for="stake_to">Stake to (escrow):</label>
  <input type="text" id="stake_to" name="stake_to" value=""> <br>
  <label for="stake_memo">Memo:</label>
  <textarea rows="2" id="stake_memo" name="stake_memo" value="" style="vertical-align:middle;"> </textarea> <br>
  <label for="proportional">Proportional unstake:</label>
  <input type="checkbox" id="proportional" > <br>
  <br>
  <div id="button-wrapper">
    <input type="button" id="setstake" value="Create QR" class="button">
    <input type="button" value="Clear QR" onclick="clearQR()" class="button">
  </div>

</div>

<div id="ReviewStakes" class="tabcontent" style="background-color:Beige;">
  <h3>Review Stakes</h3>
  <div id="stakeselector">
    <p>
    <label for="stakes">Select stake:</label>
    <select name="stakes" id="stakes"> </select>
    </p>
    <label for="r_bucket">Token quantity:</label>
    <input type="text" id="r_bucket" name="r_bucket" value="1.0000"> <br>
    <label for="r_staked">Staked quantity:</label>
    <input type="text" id="r_staked" name="r_staked" value="1.0000"> <br>
    <label for="r_stake_symbol">Staked symbol:</label>
    <input type="text" id="r_stake_symbol" name="r_stake_symbol" value=""> <br>
    <label for="r_stake_contract">Staked contract:</label>
    <input type="text" id="r_stake_contract" name="r_stake_contract" value=""> <br>
    <label for="r_stake_to">Stake to (escrow):</label>
    <input type="text" id="r_stake_to" name="r_stake_to" value=""> <br>
    <label for="r_proportional">Proportional unstake:</label>
    <input type="checkbox" id="r_proportional" > <br>
    <br>
    <div id="button-wrapper">
      <input type="button" id="delete_stake" value="Delete Stake" class="button">
      <input type="button" value="Clear QR" onclick="clearQR()" class="button">
    </div>

  </div>
  <div id="nostakes" style="display:none;"> No stakes for this token </div>
</div>

<div id="Display" class="tabcontent" style="background-color:Beige;">
  <h3>Set token display information</h3>
  <label for="token_name">Short name:</label>
  <input type="text" id="token_name" name="token_name" value="My new token"> <br>
  <label for="logo">Logo url:</label>
  <input type="text" id="logo" name="logo" value=""> <br>
</div>

<div id="Issue" class="tabcontent" style="background-color:Beige;">
  <h3>Issue tokens</h3>
  <label for="issue_qty">Quantity:</label>
  <input type="text" id="issue_qty" name="issue_qty" value="1.0000"> <br>
  <label for="issue_memo">Memo:</label>
  <textarea rows="2" id="issue_memo" name="issue_memo" value="" style="vertical-align:middle;"> </textarea> <br><br>
  <div id="button-wrapper">
    <input type="button" id="issue_tokens" value="Create QR" class="button">
    <input type="button" value="Clear QR" onclick="clearQR()" class="button">
  </div>
</div>

<div id="Open" class="tabcontent" style="background-color:Beige;">
  <h3>Enroll or remove member</h3>
  <p>
  <label for="enroll_checked">Enroll:</label>
  <input type="radio" id="enroll_checked" name="enrollment" value="open" checked>
  <label for="remove_checked" class="radiolabelhoriz">Remove:</label>
  <input type="radio" id="remove_checked" name="enrollment" value="close"> <br>
  </p>
  <label for="member_acct">Account:</label>
  <input type="text" id="member_acct" name="member_acct" value=""> <br><br>
  <input type="text" id="membership_mgr_acct" hidden> <br><br>
  <div id="button-wrapper">
    <input type="button" id="enroll_QR" value="Create QR" class="button">
    <input type="button" value="Clear QR" onclick="clearQR()" class="button">
  </div>

</div>

<div id="Redeem" class="tabcontent" style="background-color:Beige;">
  <h3>Redeem tokens</h3>
  <label for="redeem-from">Reedem from:</label>
  <input type="text" id="redeem" name="redeem" value=""> <br>
  <label for="redeem_qty">Quantity:</label>
  <input type="text" id="redeem_qty" name="redeem_qty" value="1.0000"> <br>
  <label for="redeem_memo">Memo:</label>
  <textarea rows="2" id="redeem_memo" name="redeem_memo" value="" style="vertical-align:middle;"> </textarea> <br>
</div>

<div id="Freeze" class="tabcontent" style="background-color:Beige;">
  <h3>Freeze token transfers</h3>
  <p>
  <label for="freeze_checked">Freeze:</label>
  <input type="radio" id="freeze_checked" name="freezing" value="frozen" checked>
  <label for="unfreeze_checked" class="radiolabelhoriz">Unfreeze:</label>
  <input type="radio" id="unfreeze_checked" name="freezing" value="unfrozen"> <br>
  </p>

  <label for="redeem_memo">Memo:</label>
  <textarea rows="2" id="redeem_memo" name="redeem_memo" value="" style="vertical-align:middle;"> </textarea> <br>
</div>

<div id=qrcode> </div>
<div id=esr> </div>

</body>
</html>

